# nixpacks.toml (VERSÃO CORRIGIDA)
[phases.setup]
nixPkgs = [
    "php84",
    "php84Packages.composer",
    "php84Extensions.curl",
    "php84Extensions.mbstring",
    "php84Extensions.xml",
    "php84Extensions.pdo",
    "php84Extensions.pdo_mysql",
    "php84Extensions.openssl",
    "php84Extensions.tokenizer"
]

[phases.install]
cmds = [
    "composer install --no-dev --optimize-autoloader"
]

# A chave será gerada no start, quando o .env já existir
[start]
cmd = "if [ ! -f .env ]; then touch .env && echo 'APP_ENV=production' >> .env && echo 'APP_DEBUG=false' >> .env; fi && php artisan key:generate --force && php artisan serve --host=0.0.0.0 --port=$PORT"