# nixpacks.toml (VERSÃO CORRIGIDA PARA POSTGRESQL)
[phases.setup]
nixPkgs = [
    "php84",
    "php84Packages.composer",
    "php84Extensions.curl",
    "php84Extensions.mbstring",
    "php84Extensions.xml",
    "php84Extensions.pdo",
    "php84Extensions.pdo_pgsql",  # Mudado de pdo_mysql para pdo_pgsql
    "php84Extensions.pgsql",       # Adicionado extensão PostgreSQL
    "php84Extensions.openssl",
    "php84Extensions.tokenizer",
    "php84Extensions.fileinfo",    # Adicionado para Laravel
    "php84Extensions.session",      # Adicionado para sessões
    "php84Extensions.pcntl",        # Adicionado para queues
    "php84Extensions.posix"         # Adicionado para artisan
]

[phases.install]
cmds = [
    "composer install --no-dev --optimize-autoloader"
]

[phases.build]
cmds = [
    "php artisan config:cache",
    "php artisan route:cache",
    "php artisan view:cache",
    "php artisan event:cache"
]

[start]
cmd = """
php artisan key:generate --force --no-interaction && \
php artisan migrate --force --no-interaction && \
php artisan config:clear && \
php artisan serve --host=0.0.0.0 --port=$PORT
"""